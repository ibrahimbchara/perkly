<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Perkly Admin</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <main class="layout admin-layout">
    <header class="hero compact">
      <div class="badge">Admin</div>
      <h1>Perkly Card Upload</h1>
      <p class="lead">Use one Excel template to update all cards at once.</p>
      <a class="link" href="/">Back to matcher</a>
    </header>

    <section class="flow">
      <div class="card-block">
        <h2>Download template</h2>
        <p class="hint">This Excel follows the same structure as your original file, with extra columns for calculation rules.</p>
        <div class="actions">
          <a class="link" href="/admin/cards/export-excel">Download current Excel</a>
        </div>
        <p class="hint">Add or edit cards directly in the Excel, then upload to replace the database.</p>
      </div>

      <div class="card-block">
        <h2>Upload Excel</h2>
        <form class="admin-form" method="post" action="/admin/cards/import-excel" enctype="multipart/form-data">
          <div class="input-row full">
            <label>Upload Excel (.xlsx)</label>
            <input type="file" name="cards_excel" accept=".xlsx,.xls" required />
          </div>
          <div class="actions">
            <button class="btn primary" type="submit">Upload and replace cards</button>
          </div>
        </form>
        <p class="hint">Upload replaces the full card database. Keep column names unchanged.</p>
        <p class="hint">Spend buckets used in Earn Rules JSON: travel, retail, utilities, food_groceries, fuel, transportation, real_estate, foreign.</p>
      </div>

      <div class="card-block">
        <h2>Delete a card</h2>
        <form class="admin-form" method="post" action="/admin/cards/delete">
          <div class="grid">
            <div class="input-row">
              <label>Card ID</label>
              <input type="number" name="card_id" min="1" required />
            </div>
          </div>
          <div class="actions">
            <button class="btn primary" type="submit">Delete card</button>
          </div>
        </form>
        <p class="hint">For edits, download the Excel, update the row, and upload it again.</p>
      </div>

      <div class="card-block">
        <h2>Current cards (<%= cards ? cards.length : 0 %>)</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Category</th>
                <th>Sub</th>
                <th>Program</th>
                <th>Bank</th>
                <th>Product</th>
                <th>Min Salary</th>
                <th>Annual Fee</th>
                <th>Mandatory Extra Fees</th>
              </tr>
            </thead>
            <tbody>
              <% if (cards && cards.length) { %>
                <% cards.forEach(function(card) { %>
                <tr>
                  <td><%= card.id %></td>
                  <td><%= card.card_category %></td>
                  <td><%= card.sub_category %></td>
                  <td><%= card.program %></td>
                  <td><%= card.bank_name %></td>
                  <td><%= card.product %></td>
                  <td><%= card.minimum_salary %></td>
                  <td><%= card.annual_fee %></td>
                  <td><%= card.mandatory_extra_fees_aed || 0 %></td>
                </tr>
                <% }); %>
              <% } else { %>
                <tr>
                  <td colspan="9">No cards available.</td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
</body>
</html>
